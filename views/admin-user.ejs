<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title><%= user.name %> ë‹˜ì˜ ìƒì„¸ ì •ë³´</title>
  <link rel="icon" type="image/x-icon" href="/public/favicon.png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    .reject-reason {
      margin-top: 5px;
      font-size: 0.9em;
      color: #c00;
    }
  </style>
</head>
<body>

<a href="/admin" style="display: inline-block; margin-bottom: 20px;">â† ê´€ë¦¬ì í˜ì´ì§€ë¡œ</a>

<h1><%= user.name %> ë‹˜ ìƒì„¸ ì •ë³´</h1>
<p><strong>ì´ë¦„:</strong> <%= user.name %></p>
<p><strong>í•™ë²ˆ:</strong> <%= user.studentId %></p>
<p><strong>ë“±ë¡ì¼:</strong> <%= new Date(user.createdAt).toLocaleString() %></p>

<h2>ëŒ€ì—¬ ì‹ ì²­ ê¸°ë¡</h2>
<% if (reservations.length === 0) { %>
  <p>ëŒ€ì—¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
<% } else { %>
  <table>
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>ì‹œê°„ëŒ€</th>
        <th>ìƒíƒœ</th>
        <th>ì‹ ì²­ ì‹œê°</th>
      </tr>
    </thead>
    <tbody>
      <% for (let i = 0; i < reservations.length; i++) { %>
        <tr>
          <td><%= reservations[i].date %></td>
          <td><%= reservations[i].timeSlot %></td>
          <td>
            <% if (reservations[i].status === "ê±°ì ˆ") { %>
              <span onclick="toggleRejectReason('<%= reservations[i]._id %>')" style="cursor:pointer; color:red;">ê±°ì ˆ</span>
              <div id="reason-<%= reservations[i]._id %>" class="reject-reason" style="display: none;">
                ğŸ“… <%= reservations[i].rejectedAt ? new Date(reservations[i].rejectedAt).toLocaleString() : "-" %><br>
                ğŸ“ <%= reservations[i].rejectReason || "ì‚¬ìœ  ì—†ìŒ" %>
              </div>
            <% } else { %>
              <%= reservations[i].status %>
            <% } %>
          </td>
          <td><%= new Date(reservations[i].createdAt).toLocaleString() %></td>
        </tr>
      <% } %>
    </tbody>
  </table>
<% } %>

<form id="paginationForm" method="get" action="/admin/user/<%= user.studentId %>" style="margin-top: 20px;">
  <label for="limit">í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜:</label>
  <select name="limit" id="limit" onchange="this.form.submit();">
    <option value="10" <%= Number(limit) === 10 ? 'selected' : '' %>>10ê°œ</option>
    <option value="15" <%= Number(limit) === 15 ? 'selected' : '' %>>15ê°œ</option>
    <option value="20" <%= Number(limit) === 20 ? 'selected' : '' %>>20ê°œ</option>
    <option value="30" <%= Number(limit) === 30 ? 'selected' : '' %>>30ê°œ</option>
  </select>
  <input type="hidden" name="page" value="<%= currentPage %>">
</form>

<div style="margin-top: 10px;">
  <% if (currentPage > 1) { %>
    <a href="/admin/user/<%= user.studentId %>?page=<%= currentPage - 1 %>&limit=<%= limit %>">â—€ ì´ì „</a>
  <% } %>

  <span style="margin: 0 10px;">í˜ì´ì§€ <%= currentPage %> / <%= totalPages %></span>

  <% if (currentPage < totalPages) { %>
    <a href="/admin/user/<%= user.studentId %>?page=<%= currentPage + 1 %>&limit=<%= limit %>">ë‹¤ìŒ â–¶</a>
  <% } %>
</div>


<script>
  function toggleRejectReason(id) {
    const el = document.getElementById("reason-" + id);
    if (el) {
      el.style.display = (el.style.display === "none") ? "block" : "none";
    }
  }
</script>

</body>
</html>
